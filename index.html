<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Jedi Archives ‚Äî Deluxe</title>
<meta name="description" content="Jedi Archives ‚Äì Fanprojekt √ºber Star Wars Charaktere, Planeten, Filme, Schiffe und Familien.">
<meta name="keywords" content="Star Wars, Jedi, Luke Skywalker, Leia, Yoda, Filme, Planeten, Starships, Fanprojekt">
<meta name="author" content="Maximilian Heinze">
<style>
  :root{
    --bg:#040405; --panel:#0b0b0c; --muted:#9aa0a6; --accent:#ffe81f;
    --transition: 300ms;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:var(--bg);color:#eee;
    transition: background var(--transition), color var(--transition);
    overflow: hidden;
  }

  /* galaxy canvas sits behind everything */
  #galaxy{
    position:fixed;left:0;top:0;width:100%;height:100%;z-index:0;
    pointer-events:none;mix-blend-mode:screen;opacity:0.55;
  }

  .app{
    position:relative;z-index:2;display:flex;flex-direction:column;height:100vh;
  }

  header{
    display:flex;align-items:center;gap:12px;padding:12px 16px;
    background:linear-gradient(180deg,rgba(255,232,31,0.03),transparent);
    position:sticky;top:0;z-index:50;backdrop-filter: blur(6px);
  }
  .logo{width:56px;height:56px;border-radius:8px;object-fit:cover;border:2px solid rgba(255,232,31,0.12);cursor:pointer}
  .title{color:var(--accent);font-weight:700;letter-spacing:1px}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center}

  .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px 10px;border-radius:8px;cursor:pointer}
  .container{display:flex;gap:14px;padding:14px;height:calc(100vh - 88px);position:relative;z-index:2;overflow:hidden}
  .sidebar{width:300px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);overflow:auto}
  .main{flex:1;overflow:auto;padding:8px}
  .search input{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .section{margin-bottom:14px;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px solid rgba(255,255,255,0.02)}
  .h2{color:var(--accent);margin:0 0 8px 0}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
  .card{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;transition:transform .28s,box-shadow .28s,opacity .28s;cursor:default;overflow:hidden}
  .card.hidden{opacity:0;transform:translateY(8px)}
  .card:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 18px 40px rgba(0,0,0,0.6)}
  .thumb{width:100%;height:140px;object-fit:cover;border-radius:8px;display:block}
  .small{color:var(--muted);font-size:0.9rem}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .footer{padding:12px;text-align:center;color:#8a8f95;font-size:0.85rem}

  /* music bar */
  .musicBar{display:flex;gap:12px;align-items:center}
  .progressWrap{flex:1;background:rgba(255,255,255,0.04);height:8px;border-radius:999px;cursor:pointer;position:relative}
  .progress{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#ffb84d);border-radius:999px}
  .time{font-size:0.9rem;color:var(--muted);min-width:60px;text-align:right}

  /* quiz modal */
  .modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(0.9);background:var(--panel);padding:18px;border-radius:12px;width:min(720px,92%);z-index:80;box-shadow:0 30px 80px rgba(0,0,0,0.6);opacity:0;transition:opacity .2s,transform .25s}
  .modal.show{opacity:1;transform:translate(-50%,-50%) scale(1)}
  .modal h3{margin:0 0 8px 0;color:var(--accent)}
  .modal .choices{display:flex;flex-direction:column;gap:8px;margin-top:12px}
  .closeBtn{position:absolute;right:12px;top:12px;border:none;background:transparent;color:var(--muted);cursor:pointer;font-size:1.1rem}

  /* smooth theme transition */
  .theme-transition{transition: background-color 350ms, color 350ms, border-color 350ms; }

  /* responsive */
  @media (max-width:900px){
    .container{flex-direction:column;height:auto;padding-bottom:80px}
    .sidebar{width:100%;max-height:260px;overflow:auto}
    .main{max-height:calc(100vh - 360px);overflow:auto}
  }
</style>
</head>
<body>
<canvas id="galaxy"></canvas>

<div class="app theme-transition">
  <header>
    <img src="yoda.jpg" class="logo" alt="Yoda" onerror="this.style.display='none'">
    <div class="title">Jedi Archives ‚Äî Deluxe</div>
    <div class="controls">
      <div id="musicControls" class="musicBar section" style="align-items:center;">
        <button id="playBtn" class="btn">‚ñ∂ Cantina</button>
        <div class="progressWrap" id="progressWrap" title="Klicke, um zu springen">
          <div class="progress" id="progress"></div>
        </div>
        <div class="time" id="time">0:00 / 0:00</div>
      </div>

      <button id="randCharBtn" class="btn">üé≤ Surprise</button>
      <button id="quizBtn" class="btn">‚ùì Quiz</button>
      <button id="themeBtn" class="btn">üåó Theme</button>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <div class="search section">
        <input id="q" placeholder="Suche z. B. Luke, Tatooine, Falcon..." oninput="renderAll()" />
      </div>

      <div class="section">
        <div class="h2">Filter</div>
        <div class="row">
          <button class="btn" onclick="setFilter('all')">Alle</button>
          <button class="btn" onclick="setFilter('characters')">Charaktere</button>
          <button class="btn" onclick="setFilter('planets')">Planeten</button>
          <button class="btn" onclick="setFilter('films')">Filme</button>
          <button class="btn" onclick="setFilter('starships')">Schiffe</button>
          <button class="btn" onclick="setFilter('families')">Familien</button>
        </div>
      </div>

      <div id="factBox" class="section small" style="display:none"></div>
      <div id="hints" class="section small">
        Tipp: Lade optional <code>cantina_blues.mp3</code>, <code>lightsaber.mp3</code> und <code>click.mp3</code> ins Repo-Root f√ºr volle Experience.
      </div>
    </aside>

    <main class="main">
      <section id="characters" class="section fadein">
        <h3 class="h2">Charaktere</h3>
        <div id="characters-grid" class="grid"></div>
      </section>

      <section id="planets" class="section fadein">
        <h3 class="h2">Planeten</h3>
        <div id="planets-grid" class="grid"></div>
      </section>

      <section id="starships" class="section fadein">
        <h3 class="h2">Starships & Vehicles</h3>
        <div id="starships-grid" class="grid"></div>
      </section>

      <section id="films" class="section fadein">
        <h3 class="h2">Filme</h3>
        <div id="films-grid" class="grid"></div>
      </section>

      <section id="families" class="section fadein">
        <h3 class="h2">Family Trees</h3>
        <div id="families-list"></div>
      </section>

      <div class="footer">¬© 2025 Jedi Archives ‚Äî Fanprojekt</div>
    </main>
  </div>
</div>

<!-- Audio elements -->
<audio id="cantina" src="cantina_blues.mp3" preload="none"></audio>
<audio id="sfxClick" src="click.mp3" preload="auto"></audio>
<audio id="sfxSaber" src="lightsaber.mp3" preload="auto"></audio>

<!-- Quiz modal -->
<div id="quizModal" class="modal" aria-hidden="true">
  <button class="closeBtn" id="closeQuiz">‚úï</button>
  <h3>Jedi-Quiz</h3>
  <div id="quizContent"></div>
</div>

<script>
/* -------------------------------------------
   Deluxe features JavaScript
   - robust: if asset missing -> degrade gracefully
   - keep code readable & contained
--------------------------------------------*/

/* ---------- DATA ---------- */
const DATA = {
  characters:[
    {id:'luke',name:'Luke Skywalker',role:'Jedi',born:'19 BBY',img:'luke.jpg',bio:'Sohn von Anakin, Held der Rebellion.'},
    {id:'leia',name:'Leia Organa',role:'General',born:'19 BBY',img:'leia.jpg',bio:'Prinzessin, Anf√ºhrerin der Rebellion.'},
    {id:'anakin',name:'Anakin Skywalker',role:'Jedi ‚Üí Darth Vader',born:'41 BBY',img:'anakin.jpg',bio:'Vom Jedi zum Sith.'},
    {id:'vader',name:'Darth Vader',role:'Sith',born:'41 BBY',img:'vader.jpg',bio:'Ehemals Anakin Skywalker.'},
    {id:'yoda',name:'Yoda',role:'Jedi Meister',born:'~896 BBY',img:'yoda.jpg',bio:'Weiser Meister des Jedi-Ordens.'},
    {id:'obiwan',name:'Obi-Wan Kenobi',role:'Jedi Meister',born:'57 BBY',img:'obiwan.jpg',bio:'Mentor von Anakin & Luke.'},
    {id:'han',name:'Han Solo',role:'Pilot',born:'? BBY',img:'han.jpg',bio:'Captain der Millennium Falcon.'},
    {id:'chewbacca',name:'Chewbacca',role:'Co-Pilot',born:'? BBY',img:'chewbacca.jpg',bio:'Wookiee, treuer Freund Han.'},
    {id:'rey',name:'Rey',role:'Jedi',born:'? BBY',img:'rey.jpg',bio:'Zentrale Figur der Sequels.'},
    {id:'palpatine',name:'Sheev Palpatine',role:'Sith Lord',img:'palpatine.jpg',bio:'Darth Sidious, Imperator.'},
    {id:'ahsoka',name:'Ahsoka Tano',role:'Jedi / Ex-Jedi',img:'ahsoka.jpg',bio:'Padawan von Anakin.'}
  ],
  planets:[
    {id:'tatooine',name:'Tatooine',img:'tatooine.jpg',brief:'W√ºstenplanet; zwei Sonnen.'},
    {id:'naboo',name:'Naboo',img:'naboo.jpg',brief:'Gr√ºne Welt; Padm√©s Heimat.'},
    {id:'coruscant',name:'Coruscant',img:'coruscant.jpg',brief:'Stadtplanet; Zentrum der Politik.'},
    {id:'mustafar',name:'Mustafar',img:'mustafar.jpg',brief:'Vulkanwelt; Duellplatz.'}
  ],
  starships:[
    {id:'falcon',name:'Millennium Falcon',img:'falcon.jpg',brief:'Schnelles Corellianer-Schiff.'},
    {id:'xwing',name:'X-Wing',img:'xwing.jpg',brief:'Rebellischer Sternenj√§ger.'},
    {id:'tie',name:'TIE Fighter',img:'tiefighter.jpg',brief:'Imperialer J√§ger.'}
  ],
  films:[
    {id:'ep4',title:'A New Hope',year:1977,desc:'Episode IV ‚Äì Beginn der Saga.',yt:'https://www.youtube.com/embed/vZ734NWnAHA'},
    {id:'ep5',title:'The Empire Strikes Back',year:1980,desc:'Episode V ‚Äì Wendepunkt.',yt:'https://www.youtube.com/embed/JNwNXF9Y6kY'},
    {id:'ep6',title:'Return of the Jedi',year:1983,desc:'Episode VI ‚Äì Abschluss.',yt:'https://www.youtube.com/embed/7L8p7_SLzvU'}
  ],
  families:{
    "Skywalker":["Shmi Skywalker","Anakin Skywalker / Darth Vader","Luke Skywalker","Leia Organa","Ben Solo"],
    "Organa/Solo":["Bail Organa","Leia Organa","Han Solo","Ben Solo"]
  },
  facts:[
    "Der urspr√ºngliche Filmtitel von Episode IV war einfach 'Star Wars' (1977).",
    "Yoda ist in vielen Filmen ein praktischer Effekt (Puppe) und sp√§ter CGI.",
    "Die Cantina-Szene in Episode IV enthielt damals neuartige Sound-Creations."
  ],
  quiz:[
    {q:"Wer ist Lukes Vater?", a:["Obi-Wan Kenobi","Anakin Skywalker","Yoda","Palpatine"], correct:1},
    {q:"Welcher Planet hat zwei Sonnen?", a:["Naboo","Tatooine","Mustafar","Coruscant"], correct:1},
    {q:"Wer ist ein Wookiee?", a:["C-3PO","R2-D2","Chewbacca","Boba Fett"], correct:2},
    {q:"Welcher Film ist Episode V?", a:["A New Hope","The Empire Strikes Back","Return of the Jedi","The Force Awakens"], correct:1},
    {q:"Wer war Darth Sidious?", a:["Anakin Skywalker","Luke Skywalker","Obi-Wan","Sheev Palpatine"], correct:3}
  ]
};

/* ---------- state ---------- */
let active='all';
let curTheme = localStorage.getItem('ja-theme') || 'dark';

/* ---------- helpers ---------- */
function setFilter(k){ active=k; renderAll(); }
function qmatch(q,s){ return !q || (s||'').toLowerCase().includes(q.toLowerCase()); }

/* ---------- render ---------- */
function renderAll(){
  const q=document.getElementById('q').value.trim();
  renderGrid('characters-grid', DATA.characters.filter(c=>qmatch(q,c.name+' '+c.bio)), item=>cardTemplate(item.name,item.img,item.role,item.bio));
  renderGrid('planets-grid', DATA.planets.filter(p=>qmatch(q,p.name+' '+p.brief)), item=>cardTemplate(item.name,item.img,'',item.brief));
  renderGrid('starships-grid', DATA.starships.filter(s=>qmatch(q,s.name+' '+s.brief)), item=>cardTemplate(item.name,item.img,'',item.brief));
  renderGrid('films-grid', DATA.films.filter(f=>qmatch(q,f.title+' '+f.desc)), item=>filmTemplate(item));
  renderFamilies();
  ['characters','planets','starships','films','families'].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.style.display=(active==='all' || active===id)?'block':'none';
  });
}
function cardTemplate(name,img,small,desc){
  // safe image tag (browser hides onerror)
  const src = img?`src="${img}" onerror="this.style.display='none'"`:'';
  const titleAttr = desc ? `title="${escapeHtml(desc)}"` : '';
  return `<div class="card" data-name="${escapeHtml(name)}">
    <img ${src} class="thumb" ${titleAttr}>
    <div style="margin-top:8px"><b>${escapeHtml(name)}</b><div class="small">${escapeHtml(small||'')}</div><div class="small">${escapeHtml(desc||'')}</div></div>
  </div>`;
}
function filmTemplate(item){
  return `<div class="card"><div><b>${escapeHtml(item.title)} (${item.year})</b><div class="small">${escapeHtml(item.desc)}</div></div>
    <div style="margin-top:8px" class="video-wrap"><iframe src="${item.yt}" style="width:100%;height:180px;border-radius:8px" allowfullscreen></iframe></div></div>`;
}
function renderGrid(containerId,list,templ){
  const c=document.getElementById(containerId);
  if(!c) return;
  c.innerHTML=list.map(templ).join('') || '<div class="small">Keine Eintr√§ge</div>';
  // add fade class briefly
  Array.from(c.children).forEach((el,i)=>{
    el.classList.add('hidden');
    setTimeout(()=>el.classList.remove('hidden'), 40 + i*25);
  });
}
function renderFamilies(){
  const el=document.getElementById('families-list'); if(!el) return; el.innerHTML='';
  for(const fam in DATA.families){
    const members = DATA.families[fam];
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `<b>${escapeHtml(fam)}</b><div class="small">${escapeHtml(members.join(' ‚Üí '))}</div>
      <div style="margin-top:8px"><button class="btn" onclick="focusFamily('${escapeJs(fam)}')">Details</button></div>`;
    el.appendChild(div);
  }
}
function focusFamily(name){
  const members = DATA.families[name] || [];
  const html = members.map(m=>`<div class="card small" style="margin-top:8px"><b>${escapeHtml(m)}</b></div>`).join('');
  const el=document.getElementById('families-list'); if(!el) return;
  el.innerHTML = `<div class="section"><button class="btn" onclick="renderAll()">‚óÄ zur√ºck</button><h3>${escapeHtml(name)}</h3>${html}</div>`;
}

/* ---------- small util ---------- */
function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }
function escapeJs(s){ return (s||'').replaceAll("'", "\\'"); }

/* ---------- facts ---------- */
document.getElementById('factBox').style.display='none';
document.getElementById('factBtn').addEventListener('click', ()=>{
  const f = DATA.facts[Math.floor(Math.random()*DATA.facts.length)];
  const fb = document.getElementById('factBox'); fb.style.display='block'; fb.textContent = f;
  setTimeout(()=>fb.style.display='none',7000);
});

/* ---------- AUDIO & SFX ---------- */
const audio = document.getElementById('cantina');
const sfxClick = document.getElementById('sfxClick');
const sfxSaber = document.getElementById('sfxSaber');
const playBtn = document.getElementById('playBtn');
const progress = document.getElementById('progress');
const progressWrap = document.getElementById('progressWrap');
const timeLabel = document.getElementById('time');

let sfxClickOk = true, sfxSaberOk = true, cantinaOk = true;
// check assets exist (HEAD)
function checkAsset(el){
  if(!el || !el.src) return Promise.reject();
  return fetch(el.src, {method:'HEAD'}).then(r=>r.ok?Promise.resolve():Promise.reject()).catch(()=>Promise.reject());
}
Promise.allSettled([checkAsset(audio), checkAsset(sfxClick), checkAsset(sfxSaber)])
  .then(results=>{
    cantinaOk = results[0] && results[0].status==='fulfilled';
    sfxClickOk = results[1] && results[1].status==='fulfilled';
    sfxSaberOk = results[2] && results[2].status==='fulfilled';
    // hide hints if cantina ok
    if(cantinaOk){
      const hints = document.getElementById('hints'); if(hints) hints.style.display='none';
    }
    if(!sfxClickOk) { if(sfxClick) sfxClick.remove(); }
    if(!sfxSaberOk) { if(sfxSaber) sfxSaber.remove(); }
  });

playBtn.addEventListener('click', ()=>{
  if(!cantinaOk){ alert('Musikdatei cantina_blues.mp3 nicht erreichbar.'); return; }
  // sfx click
  if(sfxClickOk) { try { sfxClick.currentTime=0; sfxClick.play().catch(()=>{}); } catch(e){} }
  if(audio.paused){
    audio.play().then(()=>{ playBtn.textContent='‚è∏ Cantina'; }).catch(e=>{ alert('Autoplay blockiert ‚Äî bitte tippe nochmal.'); });
  } else {
    audio.pause(); playBtn.textContent='‚ñ∂ Cantina';
  }
});
audio.addEventListener('timeupdate', ()=>{
  const pct = audio.duration? (audio.currentTime / audio.duration * 100) : 0;
  progress.style.width = pct + '%';
  timeLabel.textContent = formatTime(audio.currentTime) + ' / ' + (audio.duration?formatTime(audio.duration):'0:00');
});
progressWrap.addEventListener('click', (e)=>{
  if(!audio.duration) return;
  const r = progressWrap.getBoundingClientRect();
  const x = e.clientX - r.left;
  const pct = Math.max(0, Math.min(1, x / r.width));
  audio.currentTime = pct * audio.duration;
});
function formatTime(s){
  if(!s && s!==0) return '0:00';
  const m = Math.floor(s/60); const sec = Math.floor(s%60).toString().padStart(2,'0');
  return `${m}:${sec}`;
}

/* ---------- Random Character button ---------- */
document.getElementById('randCharBtn').addEventListener('click', ()=>{
  const arr = DATA.characters;
  const c = arr[Math.floor(Math.random()*arr.length)];
  // show a modal-ish card in alert-style: nicer small overlay
  const details = `${c.name}\n${c.role}\n${c.bio}`;
  if(sfxClickOk){ try { sfxClick.currentTime=0; sfxClick.play().catch(()=>{}); } catch(e){} }
  alert(details);
});

/* ---------- Quiz ---------- */
const quizModal = document.getElementById('quizModal');
const quizBtn = document.getElementById('quizBtn');
const closeQuiz = document.getElementById('closeQuiz');
quizBtn.addEventListener('click', ()=> openQuiz());
closeQuiz.addEventListener('click', ()=> closeQuizModal());

function openQuiz(){
  const content = document.getElementById('quizContent');
  let idx = 0; let score = 0;
  content.innerHTML = '';
  const q = DATA.quiz[idx];
  renderQuestion();
  quizModal.classList.add('show'); quizModal.setAttribute('aria-hidden','false');

  function renderQuestion(){
    const q = DATA.quiz[idx];
    if(!q) return;
    content.innerHTML = `<div><strong>${escapeHtml(q.q)}</strong></div>
      <div class="choices">${q.a.map((opt,i)=>`<button class="btn choiceBtn" data-i="${i}">${escapeHtml(opt)}</button>`).join('')}</div>
      <div style="margin-top:12px"><small class="small">Frage ${idx+1} von ${DATA.quiz.length}</small></div>`;
    Array.from(content.querySelectorAll('.choiceBtn')).forEach(b=>{
      b.addEventListener('click', (ev)=>{
        const picked = Number(ev.currentTarget.dataset.i);
        if(picked === q.correct){ score++; ev.currentTarget.style.borderColor='lime'; }
        else { ev.currentTarget.style.borderColor='tomato'; if(sfxSaberOk){ try { sfxSaber.currentTime=0; sfxSaber.play().catch(()=>{}); } catch(e){} } }
        // disable buttons
        Array.from(content.querySelectorAll('.choiceBtn')).forEach(x=>x.disabled=true);
        setTimeout(()=>{ idx++; if(idx<DATA.quiz.length) renderQuestion(); else finishQuiz(); }, 800);
      });
    });
  }
  function finishQuiz(){
    content.innerHTML = `<div><strong>Ergebnis</strong></div><div style="margin-top:10px"><b>${score} / ${DATA.quiz.length}</b></div>
      <div style="margin-top:12px"><button class="btn" id="closeResult">Schlie√üen</button></div>`;
    document.getElementById('closeResult').addEventListener('click', ()=> closeQuizModal());
  }
}
function closeQuizModal(){
  quizModal.classList.remove('show'); quizModal.setAttribute('aria-hidden','true');
}

/* ---------- Theme handling (smooth) ---------- */
const themeBtn = document.getElementById('themeBtn');
function applyTheme(t){
  if(t==='light'){
    document.documentElement.style.setProperty('--bg','#f7f7f7');
    document.body.style.color='#111';
    document.documentElement.style.setProperty('--accent','#2e6bd6');
  } else {
    document.documentElement.style.setProperty('--bg','#040405');
    document.body.style.color='#eee';
    document.documentElement.style.setProperty('--accent','#ffe81f');
  }
  localStorage.setItem('ja-theme', t);
  curTheme = t;
}
themeBtn.addEventListener('click', ()=>{
  applyTheme(curTheme==='dark'?'light':'dark');
});
applyTheme(curTheme);

/* ---------- Yoda Easter Egg ---------- */
const yodaQuotes = [
  "Do or do not, there is no try.",
  "Fear is the path to the dark side.",
  "Wars not make one great.",
  "Always pass on what you have learned."
];
const logo = document.querySelector('.logo');
logo && logo.addEventListener('click', ()=>{
  if(sfxClickOk){ try { sfxClick.currentTime=0; sfxClick.play().catch(()=>{}); } catch(e){} }
  alert(yodaQuotes[Math.floor(Math.random()*yodaQuotes.length)]);
});

/* ---------- Galaxy background (canvas) ---------- */
(function galaxy(){
  const canvas = document.getElementById('galaxy');
  const ctx = canvas.getContext('2d');
  let w=canvas.width=innerWidth, h=canvas.height=innerHeight;
  window.addEventListener('resize', ()=>{ w=canvas.width=innerWidth; h=canvas.height=innerHeight; });
  const stars=[];
  const STAR_COUNT = Math.max(60, Math.floor((w*h)/8000));
  for(let i=0;i<STAR_COUNT;i++){
    stars.push({
      x: Math.random()*w,
      y: Math.random()*h,
      r: Math.random()*1.8+0.2,
      vx: (Math.random()-0.5)*0.12,
      vy: (Math.random()-0.5)*0.12,
      hue: Math.random()*360,
      alpha: Math.random()*0.6+0.2
    });
  }
  function draw(){
    ctx.clearRect(0,0,w,h);
    // subtle gradient
    const g = ctx.createLinearGradient(0,0,w,h);
    g.addColorStop(0,'rgba(6,7,12,0.8)');
    g.addColorStop(1,'rgba(20,12,30,0.85)');
    ctx.fillStyle = g; ctx.fillRect(0,0,w,h);
    for(const s of stars){
      s.x += s.vx; s.y += s.vy;
      if(s.x<0) s.x=w; if(s.x>w) s.x=0;
      if(s.y<0) s.y=h; if(s.y>h) s.y=0;
      ctx.beginPath();
      ctx.fillStyle = `hsla(${s.hue},80%,90%,${s.alpha})`;
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fill();
    }
    requestAnimationFrame(draw);
  }
  draw();
})();

/* ---------- init ---------- */
document.getElementById('q').addEventListener('keydown', e=>{ if(e.key==='Enter') renderAll(); });
// delegate clicks on cards for sound effect
document.addEventListener('click', (e)=>{
  const card = e.target.closest('.card');
  if(card && sfxClickOk){
    try{ sfxClick.currentTime=0; sfxClick.play().catch(()=>{}); } catch(e){}
  }
});
renderAll();
</script>
</body>
</html>
